import{r as i}from"./index.DhYZZe0J.js";var F={exports:{}},x={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L=i,y=Symbol.for("react.element"),P=Symbol.for("react.fragment"),C=Object.prototype.hasOwnProperty,B=L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,w={key:!0,ref:!0,__self:!0,__source:!0};function v(e,s,l){var a,c={},_=null,T=null;l!==void 0&&(_=""+l),s.key!==void 0&&(_=""+s.key),s.ref!==void 0&&(T=s.ref);for(a in s)C.call(s,a)&&!w.hasOwnProperty(a)&&(c[a]=s[a]);if(e&&e.defaultProps)for(a in s=e.defaultProps,s)c[a]===void 0&&(c[a]=s[a]);return{$$typeof:y,type:e,key:_,ref:T,props:c,_owner:B.current}}x.Fragment=P;x.jsx=v;x.jsxs=v;F.exports=x;var t=F.exports;const D={logoSplash:"/assets/img/evo_splash_04.png",cardLoader:"/assets/img/cardLoader.svg",loader:"/assets/img/loader.svg",noLoader:"/assets/img/noLoader.svg",typeless:"/assets/img/typeless.png",moreStatusEffects:"/assets/img/passive_quest_icon.png",moves:"/assets/img/moves.png",characters:"/assets/img/characters.png",meta:"/assets/img/meta/meta_tape_default.png",metaTapeBg:"/assets/img/meta/meta_tape_bg.png",metaTapeBootlegBg:"/assets/img/meta/meta_tape_bootleg_bg.png",metaTapeOverlay:"/assets/img/meta/meta_tape_overlay.png",metaAp:"/assets/img/meta/ap.png",metaApx:"/assets/img/meta/ap-x.png",characterBg:"/assets/img/meta/character_bg.png",overworldBg:"/assets/img/game/data/map_metadata/overworld.png",tapeBg:"/assets/img/meta/tape.png",tapeBootlegBg:"/assets/img/meta/tape_bootleg.png",tapeOverlay:"/assets/img/meta/tape_overlay.png",unknown:"/assets/img/passive_quest_icon.png"},b=e=>{let s=3;switch(e.size){case"xs":s=1;break;case"sm":s=2;break;case"md":s=3;break;case"lg":s=6;break;case"xl":s=12;break}const l=`${s*8}px`;return t.jsx("img",{src:D.loader,className:"noselect",style:{width:l,height:l},draggable:"false",alt:"loading"})},O="en",Y={remaster:"UI_EVOLUTION_TITLE",stickers:"UI_PARTY_STICKERS",maxHP:"SHORT_NAME_max_hp",mAtk:"SHORT_NAME_melee_attack",mDef:"SHORT_NAME_melee_defense",rAtk:"SHORT_NAME_ranged_attack",rDef:"SHORT_NAME_ranged_defense",speed:"SHORT_NAME_speed",elementalType:"UI_INVENTORY_FILTER_TYPE",name:"UI_INVENTORY_FILTER_NAME",category:"UI_INVENTORY_FILTER_CATEGORY",power:"MOVE_DESCRIPTION_POWER",accuracy:"STAT_accuracy",evasion:"STAT_evasion",maxAP:"STAT_max_ap",moveSlots:"STAT_move_slots",ap:"BATTLE_TOAST_AP",chance:"BATTLE_TOAST_RECORD_CHANCE",recording:"STATUS_RECORDING_NAME",chooseSpecialisation:"UI_EVOLUTION_SPECIALIZATION",expPoints:"STAT_exp",viewMonsters:"UI_BESTIARY_LIST_MODE_VIEW_MONSTERS",viewStickers:"UI_PARTY_VIEW_MOVES",elementalTypeChart:"ITEM_TYPE_CHART_NAME",statusEffect:"MOVE_CATEGORY_STATUS",language:"TITLE_SCREEN_LANGUAGE_BUTTON",other:"UI_QUEST_LOG_SECTION_OTHER",applySticker:"UI_PARTY_APPLY_STICKER",stats:"UI_BESTIARY_INFO_TAB_STATS",passive:"UI_BUTTON_MOVE_PASSIVE",priorityChance:"STAT_priority_chance",humanForm:"UI_PARTY_STATS_CHARACTER",habitat:"UI_BESTIARY_INFO_TAB_LOCATION",unlockedAbility:"ABILITY_UNLOCKED",dlcPierOfTheUnknown:"DLC_01_PIER_NAME",attacker:"TYPE_CHART_ATTACKER",defender:"TYPE_CHART_DEFENDER",transmutation:"TYPE_CHART_TRANSMUTATION",noReaction:"TYPE_CHART_NO_REACTION",buffs:"TYPE_CHART_BUFFS",debuffs:"TYPE_CHART_DEBUFFS",map:"UI_PAUSE_MAP_BTN",typeless:"UI_INVENTORY_FILTER_TYPE_TYPELESS",cassetteBeasts:"MAIN_CREDITS_TITLE",homePageLongText1:"TUTORIAL_REMASTER",homePageLongText2:"TUTORIAL_RUMORS_DESCRIPTION1",fusion:"ONLINE_REQUEST_UI_BATTLE_RULES_REL_LEVEL",sameFusion1:"SAME_FUSION_NAME_1",sameFusion2:"SAME_FUSION_NAME_2",sameFusion3:"SAME_FUSION_NAME_3",sameFusion4:"SAME_FUSION_NAME_4",sameFusion5:"SAME_FUSION_NAME_5",sameFusion6:"SAME_FUSION_NAME_6",sameFusion7:"SAME_FUSION_NAME_7",sameFusion8:"SAME_FUSION_NAME_8",sameFusion9:"SAME_FUSION_NAME_9",fusionDescription1:"TUTORIAL4_PART3C_KAYLEIGH2",fusionDescription2:"TUTORIAL_BOSS_1.m",fusionDescription3:"TUTORIAL_FUSION1.m"},U=e=>{if((e??"").indexOf("res://")<0)return e??"";const s=(e??"").replace("res://","");return s.length<1?"/assets/img/passive_quest_icon.png?orig="+e:`/assets/img/generated/${s}`},R=e=>{let s=i.createRef();const[l,a]=i.useState(""),[c,_]=i.useState(!1),[T,m]=i.useState([]);i.useEffect(()=>{m(e.monsters)},[]);const g=()=>{if(c)return;_(!0);const n=s.current;setTimeout(()=>{n.focus()},250)},r=n=>t.jsxs(t.Fragment,{children:[t.jsx("img",{src:U(n.icon),alt:n.name,loading:"lazy"}),t.jsx("p",{children:n.name})]}),u=n=>{const f=n.target?.value??"",d=e.monsters.filter(A=>A.name.toLocaleLowerCase().includes(f.toLocaleLowerCase()));m(d),a(f)},o=n=>{e.selectMonster(n),_(!1),a(""),m(e.monsters)};return t.jsxs("div",{className:"monster dropdown"+(c?" open":""),children:[t.jsx("div",{className:"dropdown-backdrop noselect",onClick:()=>_(!1)}),e.selectedMonster!=null&&c==!1&&t.jsx("div",{className:"fake-input noselect",children:t.jsx("div",{className:"monster-option selected",onClick:g,children:r(e.selectedMonster)})}),t.jsx("input",{type:"text",ref:s,className:"dropdown-input "+(e.selectedMonster!=null&&c==!1?"hidden":""),placeholder:e.translate[Y.viewMonsters],value:l,onFocus:g,onInput:u}),t.jsx("ul",{className:"noselect",children:T.length>0?t.jsx(t.Fragment,{children:T.map(n=>t.jsx("li",{className:"monster-option noselect",onClick:()=>o(n),children:r(n)},n.id))}):t.jsxs("li",{className:"monster-option disabled noselect",children:[e.translate.noItems,"..."]})})]})},k=e=>{const[s,l]=i.useState("");return i.useEffect(()=>{if(e.monsterA==null&&e.monsterB==null){l("...");return}if(e.monsterA?.id==e.monsterB?.id){const a=(e.monsterA?.bestiary_index??0)%10,c=e.translate[`SAME_FUSION_NAME_${a+1}`];l(c.replace("{0}",e.monsterA?.name??""));return}l(`${e.monsterA?.prefix??"..."}${e.monsterB?.suffix??"..."}`)},[e.monsterA?.id,e.monsterB?.id]),t.jsx("h2",{className:"ta-center mt-1",children:s})},H=e=>Math.max(e.lastIndexOf("\\"),e.lastIndexOf("/")),z=e=>{const s=H(e);return e.substring(s+1)},V=e=>{const s=e.sizeMultiplier??3,l=e.fusion??{};if(l.visible==!1)return;const a=(r,u)=>{let o=r[u.name];if(o==null){const f=z(u.instance_external_path??"").replace(".json","");o=r[f]}const n=o?.animations?.[0]?.frames?.[0];return{width:n?.width!=null?n.width*s+"px":"unset",height:n?.height!=null?n.height*s+"px":"unset"}},c=r=>r*s+"px",_=r=>{const u=r.instance_external_path??"",o=U(u.replace(".json",".png"));if((o?.length??0)!=0)return o},m=((r,u)=>{if(r==null)return;const o={...r};if((o?.parent?.length??0)!=0){const n=u[o.parent];if(n!=null){if(n.visible==!1)return;o.position.y=n.position.y,o.position.x=n.position.x}}return o})(l,e.fusionPartsList);if(m==null)return;const g=_(m);if(g!=null)return t.jsx("img",{id:m.name,src:g,alt:m.name,className:"fusion-node",style:{top:c(m.position.y),left:c(m.position.x),width:a(e.fusionSpriteMap,m).width,height:a(e.fusionSpriteMap,m).height,zIndex:m.index??0}})},$=e=>{const[s,l]=i.useState(),[a,c]=i.useState(),[_,T]=i.useState(0),[m,g]=i.useState(0),[r,u]=i.useState(1);i.useEffect(()=>{if(e.fusionSpriteMap==null||e.itemMap==null)return;const n=e.itemMap[e.monsterA?.id??""];n!=null&&l(n.nodes_enhanced);const f=e.itemMap[e.monsterB?.id??""];f!=null&&c(f.nodes_enhanced);let d=0,A=0;for(const p of Object.values(e.fusionSpriteMap??{})){const S=p.animations[0].frames[0];S.height>d&&(d=S.height),S.width>A&&(A=S.width)}let h=0;for(const p of Object.values(n?.nodes_enhanced??{}))p.position.y<h&&(h=p.position.y);const I=screen.availHeight/2.5/d,N=screen.availWidth/2.5/A,M=Math.min(I,N);T(d),u(M),g(Math.abs(h)*M)},[e.monsterA?.id,e.monsterB?.id,e.fusionSpriteMap,e.itemMap]);const o=(n,f)=>{let d=[];for(const A of Object.values(n??{}))d.push(A);return d};return t.jsxs(t.Fragment,{children:[t.jsx(k,{translate:e.translate,monsterA:e.monsterA,monsterB:e.monsterB}),t.jsx("div",{className:"fusion-container mb-1",children:s!=null&&a!=null&&t.jsx("div",{className:"fusion-item",style:{marginTop:`${m}px`,height:r*_+"px",width:r*_+"px"},children:o(s).map(n=>t.jsx(V,{fusion:n,fusionSpriteMap:e.fusionSpriteMap,fusionPartsList:s??{},sizeMultiplier:r},n.name))})})]})};var E=(e=>(e[e.pending=0]="pending",e[e.loading=1]="loading",e[e.success=2]="success",e[e.error=3]="error",e))(E||{});const W=e=>{const[s,l]=i.useState(),[a,c]=i.useState(),[_,T]=i.useState({}),[m,g]=i.useState({}),[r,u]=i.useState([]),[o,n]=i.useState(E.loading),f=async()=>{const d=fetch(`/${O}/data/fusion.json`),A=fetch(`/${O}/data/fusionSpriteAnim.json`),h=fetch(`/${e.locale}/data/monsterDropDown.json`);try{const[I,N,M]=await Promise.all([d,A,h]),[p,S,j]=await Promise.all([I.json(),N.json(),M.json()]);T(p),g(S),u(j)}catch(I){console.log(I),n(E.error)}n(E.success)};return i.useEffect(()=>{f()},[]),t.jsxs(t.Fragment,{children:[t.jsx("article",{className:"mb-1 warning",children:t.jsx("div",{className:"card ta-center",children:"⚠️ This is a work in progress"})}),t.jsx("article",{className:"mb-1",children:t.jsxs("div",{className:"fusion",children:[(o===E.loading||o===E.pending)&&t.jsx("div",{className:"fusion-container",children:t.jsx("div",{style:{margin:"5vh auto"},children:t.jsx(b,{size:"xl"})})}),o===E.error&&t.jsx("summary",{"data-TODO":"translate",children:"❌ Something went wrong"}),o===E.success&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid",children:[t.jsx(R,{translate:e.translate,monsters:r,selectedMonster:s,selectMonster:l}),t.jsx(R,{translate:e.translate,monsters:r,selectedMonster:a,selectMonster:c})]}),t.jsx($,{translate:e.translate,itemMap:_,fusionSpriteMap:m,monsterA:s,monsterB:a})]})]})})]})};export{W as FusionPanel};
