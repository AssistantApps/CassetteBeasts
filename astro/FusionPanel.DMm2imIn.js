import{g as d,c as P,s as N,t as T,d as j,a as $,i as E,b as S,M as x,e as L,S as B,r as G,u as K,f as h,h as D,j as W,o as q}from"./web.D8B_reay.js";const Q={logoSplash:"/assets/img/evo_splash_04.png",loader:"/assets/img/loader.svg",moreStatusEffects:"/assets/img/passive_quest_icon.png",moves:"/assets/img/moves.png",characters:"/assets/img/characters.png",meta:"/assets/img/meta/meta_tape_default.png",metaTapeBg:"/assets/img/meta/meta_tape_bg.png",metaTapeBootlegBg:"/assets/img/meta/meta_tape_bootleg_bg.png",metaTapeOverlay:"/assets/img/meta/meta_tape_overlay.png",metaAp:"/assets/img/meta/ap.png",metaApx:"/assets/img/meta/ap-x.png",characterBg:"/assets/img/meta/character_bg.png",tapeBg:"/assets/img/meta/tape.png",tapeBootlegBg:"/assets/img/meta/tape_bootleg.png",tapeOverlay:"/assets/img/meta/tape_overlay.png",unknown:"/assets/img/passive_quest_icon.png"};var Z=T("<img class=noselect draggable=false alt=loading>");const Y=e=>{let s=3;switch(e.size){case"xs":s=1;break;case"sm":s=2;break;case"md":s=3;break;case"lg":s=6;break;case"xl":s=12;break}const u=`${s*8}px`;return(()=>{var o=d(Z);return u!=null?o.style.setProperty("width",u):o.style.removeProperty("width"),u!=null?o.style.setProperty("height",u):o.style.removeProperty("height"),P(()=>N(o,"src",Q.loader)),o})()},b="en",J={remaster:"UI_EVOLUTION_TITLE",stickers:"UI_PARTY_STICKERS",maxHP:"SHORT_NAME_max_hp",mAtk:"SHORT_NAME_melee_attack",mDef:"SHORT_NAME_melee_defense",rAtk:"SHORT_NAME_ranged_attack",rDef:"SHORT_NAME_ranged_defense",speed:"SHORT_NAME_speed",elementalType:"UI_INVENTORY_FILTER_TYPE",name:"UI_INVENTORY_FILTER_NAME",category:"UI_INVENTORY_FILTER_CATEGORY",power:"MOVE_DESCRIPTION_POWER",accuracy:"STAT_accuracy",evasion:"STAT_evasion",maxAP:"STAT_max_ap",moveSlots:"STAT_move_slots",ap:"BATTLE_TOAST_AP",chance:"BATTLE_TOAST_RECORD_CHANCE",recording:"STATUS_RECORDING_NAME",chooseSpecialisation:"UI_EVOLUTION_SPECIALIZATION",expPoints:"STAT_exp",viewMonsters:"UI_BESTIARY_LIST_MODE_VIEW_MONSTERS",viewStickers:"UI_PARTY_VIEW_MOVES",elementalTypeChart:"ITEM_TYPE_CHART_NAME",statusEffect:"MOVE_CATEGORY_STATUS",language:"TITLE_SCREEN_LANGUAGE_BUTTON",other:"UI_QUEST_LOG_SECTION_OTHER",applySticker:"UI_PARTY_APPLY_STICKER",stats:"UI_BESTIARY_INFO_TAB_STATS",passive:"UI_BUTTON_MOVE_PASSIVE",priorityChance:"STAT_priority_chance",humanForm:"UI_PARTY_STATS_CHARACTER",habitat:"UI_BESTIARY_INFO_TAB_LOCATION",unlockedAbility:"ABILITY_UNLOCKED",dlcPierOfTheUnknown:"DLC_01_PIER_NAME",attacker:"TYPE_CHART_ATTACKER",defender:"TYPE_CHART_DEFENDER",transmutation:"TYPE_CHART_TRANSMUTATION",noReaction:"TYPE_CHART_NO_REACTION",buffs:"TYPE_CHART_BUFFS",debuffs:"TYPE_CHART_DEBUFFS",map:"UI_PAUSE_MAP_BTN",typeless:"UI_INVENTORY_FILTER_TYPE_TYPELESS",cassetteBeasts:"MAIN_CREDITS_TITLE",homePageLongText1:"TUTORIAL_REMASTER",homePageLongText2:"TUTORIAL_RUMORS_DESCRIPTION1",fusion:"ONLINE_REQUEST_UI_BATTLE_RULES_REL_LEVEL",sameFusion1:"SAME_FUSION_NAME_1",sameFusion2:"SAME_FUSION_NAME_2",sameFusion3:"SAME_FUSION_NAME_3",sameFusion4:"SAME_FUSION_NAME_4",sameFusion5:"SAME_FUSION_NAME_5",sameFusion6:"SAME_FUSION_NAME_6",sameFusion7:"SAME_FUSION_NAME_7",sameFusion8:"SAME_FUSION_NAME_8",sameFusion9:"SAME_FUSION_NAME_9",fusionDescription1:"TUTORIAL4_PART3C_KAYLEIGH2",fusionDescription2:"TUTORIAL_BOSS_1.m",fusionDescription3:"TUTORIAL_FUSION1.m"};var O=(e=>(e[e.pending=0]="pending",e[e.loading=1]="loading",e[e.success=2]="success",e[e.error=3]="error",e))(O||{});const k=e=>{if((e??"").indexOf("res://")<0)return e;const s=(e??"").replace("res://","");return s.length<1?"/assets/img/passive_quest_icon.png?old="+e:`/assets/img/generated/${s}`};var X=T("<img loading=lazy>"),ee=T("<p>"),te=T("<summary data-todo=translate>❌ Something went wrong"),ne=T("<summary>"),se=T('<details class="monster dropdown"><!$><!/><ul>'),re=T("<summary data-todo=translate><!$><!/> Loading"),ae=T('<div class="monster-option selected">'),ie=T('<li class="monster-option noselect">');const C=e=>{let s;const u=_=>[(()=>{var A=d(X);return P(p=>{var m=k(_.icon),v=_.name;return m!==p.e&&N(A,"src",p.e=m),v!==p.t&&N(A,"alt",p.t=v),p},{e:void 0,t:void 0}),A})(),(()=>{var A=d(ee);return E(A,()=>_.name),A})()],o=_=>{s?.removeAttribute("open"),e.selectMonster(_)};return(()=>{var _=d(se),A=_.firstChild,[p,m]=$(A.nextSibling),v=p.nextSibling,n=s;return typeof n=="function"?K(n,_):s=_,E(_,S(B,{get fallback(){return(()=>{var t=d(re),r=t.firstChild,[a,l]=$(r.nextSibling);return a.nextSibling,E(t,S(Y,{size:"sm"}),a,l),t})()},get children(){return[S(x,{get when(){return e.networkState===O.error},get children(){return d(te)}}),S(x,{get when(){return e.networkState===O.success},get children(){var t=d(ne);return E(t,(()=>{var r=L(()=>e.selectedMonster!=null);return()=>r()?(()=>{var a=d(ae);return E(a,()=>u(e.selectedMonster)),a})():e.translate[J.viewMonsters]})()),t}})]}}),p,m),E(v,()=>e.monsters.map(t=>(()=>{var r=d(ie);return r.$$click=()=>o(t),E(r,()=>u(t)),G(),r})())),_})()};j(["click"]);var oe=T('<h2 class="ta-center mt-1">');const le=e=>{const[s,u]=h("");return D(()=>{if(e.monsterA==null&&e.monsterB==null){u("...");return}if(e.monsterA?.id==e.monsterB?.id){const o=(e.monsterA?.bestiary_index??0)%10,_=e.translate[`SAME_FUSION_NAME_${o+1}`];u(_.replace("{0}",e.monsterA?.name??""));return}u(`${e.monsterA?.prefix??"..."}${e.monsterB?.suffix??"..."}`)},[e.monsterA?.id,e.monsterB?.id]),(()=>{var o=d(oe);return E(o,s),o})()},_e=e=>Math.max(e.lastIndexOf("\\"),e.lastIndexOf("/")),ue=e=>{const s=_e(e);return e.substring(s+1)};var me=T("<img class=fusion-node>");const ce=e=>{const s=e.sizeMultiplier??3,u=e.fusion??{};if(u.visible==!1)return;const o=(n,t)=>{let r=n[t.name];if(r==null){const l=ue(t.instance_external_path??"").replace(".json","");r=n[l]}const a=r?.animations?.[0]?.frames?.[0];return{width:a?.width!=null?a.width*s+"px":"unset",height:a?.height!=null?a.height*s+"px":"unset"}},_=n=>n*s+"px",A=n=>{const t=n.instance_external_path??"",r=k(t.replace(".json",".png"));if((r?.length??0)!=0)return r},m=((n,t)=>{if(n==null)return;const r={...n};if((r?.parent?.length??0)!=0){const a=t[r.parent];if(a!=null){if(a.visible==!1)return;r.position.y=a.position.y,r.position.x=a.position.x}}return r})(u,e.fusionPartsList);if(m==null)return;const v=A(m);if(v!=null)return(()=>{var n=d(me);return N(n,"src",v),P(t=>{var r=m.name,a=m.name,l=_(m.position.y),i=_(m.position.x),c=o(e.fusionSpriteMap,m).width,g=o(e.fusionSpriteMap,m).height,f=m.index??0;return r!==t.e&&N(n,"id",t.e=r),a!==t.t&&N(n,"alt",t.t=a),l!==t.a&&((t.a=l)!=null?n.style.setProperty("top",l):n.style.removeProperty("top")),i!==t.o&&((t.o=i)!=null?n.style.setProperty("left",i):n.style.removeProperty("left")),c!==t.i&&((t.i=c)!=null?n.style.setProperty("width",c):n.style.removeProperty("width")),g!==t.n&&((t.n=g)!=null?n.style.setProperty("height",g):n.style.removeProperty("height")),f!==t.s&&((t.s=f)!=null?n.style.setProperty("z-index",f):n.style.removeProperty("z-index")),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),n})()};var ge=T("<div class=fusion-item>"),de=T('<div class="fusion-container mb-1">');const Te=e=>{const[s,u]=h(),[o,_]=h(),[A,p]=h(0),[m,v]=h(0),[n,t]=h(1);D(()=>{if(e.fusionSpriteMap==null||e.itemMap==null)return;const a=e.itemMap[e.monsterA?.id??""];a!=null&&u(a.nodes_enhanced);const l=e.itemMap[e.monsterB?.id??""];l!=null&&_(l.nodes_enhanced);let i=0,c=0;for(const M of Object.values(e.fusionSpriteMap??{})){const I=M.animations[0].frames[0];I.height>i&&(i=I.height),I.width>c&&(c=I.width)}let g=0;for(const M of Object.values(a?.nodes_enhanced??{}))M.position.y<g&&(g=M.position.y);const f=screen.availHeight/2.5/i,y=screen.availWidth/2.5/c,R=Math.min(f,y);p(i),t(R),v(Math.abs(g)*R)},[e.monsterA?.id,e.monsterB?.id,e.fusionSpriteMap,e.itemMap]);const r=(a,l)=>{let i=[];for(const c of Object.values(a??{}))i.push(c);return i};return[S(le,{get translate(){return e.translate},get monsterA(){return e.monsterA},get monsterB(){return e.monsterB}}),(()=>{var a=d(de);return E(a,S(W,{get when(){return L(()=>s()!=null)()&&o()!=null},get children(){var l=d(ge);return E(l,()=>r(s(),o()).map(i=>S(ce,{fusion:i,get fusionSpriteMap(){return e.fusionSpriteMap},get fusionPartsList(){return s()??{}},get sizeMultiplier(){return n()}}))),P(i=>{var c=`${m()}px`,g=n()*A()+"px",f=n()*A()+"px";return c!==i.e&&((i.e=c)!=null?l.style.setProperty("margin-top",c):l.style.removeProperty("margin-top")),g!==i.t&&((i.t=g)!=null?l.style.setProperty("height",g):l.style.removeProperty("height")),f!==i.a&&((i.a=f)!=null?l.style.setProperty("width",f):l.style.removeProperty("width")),i},{e:void 0,t:void 0,a:void 0}),l}})),a})()]};var Ae=T('<article class="mb-1 warning"><div class="card ta-center">⚠️ This is a work in progress'),fe=T("<summary data-todo=translate>❌ Something went wrong"),Ee=T("<article class=mb-1><div class=fusion><div class=grid><!$><!/><!$><!/></div><!$><!/>"),Se=T("<div class=fusion-container><div>");const he=e=>{const[s,u]=h(),[o,_]=h(),[A,p]=h({}),[m,v]=h({}),[n,t]=h([]),[r,a]=h(O.loading),l=async()=>{const i=fetch(`/${b}/data/fusion.json`),c=fetch(`/${b}/data/fusionSpriteAnim.json`),g=fetch(`/${e.locale}/data/monsterDropDown.json`);try{const[f,y,R]=await Promise.all([i,c,g]),[M,I,F]=await Promise.all([f.json(),y.json(),R.json()]);p(M),v(I),t(F)}catch(f){console.log(f),a(O.error)}a(O.success)};return q(()=>{l()}),[d(Ae),(()=>{var i=d(Ee),c=i.firstChild,g=c.firstChild,f=g.firstChild,[y,R]=$(f.nextSibling),M=y.nextSibling,[I,F]=$(M.nextSibling),H=g.nextSibling,[z,V]=$(H.nextSibling);return E(g,S(C,{get networkState(){return r()},get translate(){return e.translate},get monsters(){return n()},get selectedMonster(){return s()},selectMonster:u}),y,R),E(g,S(C,{get networkState(){return r()},get translate(){return e.translate},get monsters(){return n()},get selectedMonster(){return o()},selectMonster:_}),I,F),E(c,S(B,{get fallback(){return(()=>{var U=d(Se),w=U.firstChild;return w.style.setProperty("margin","5vh auto"),E(w,S(Y,{size:"xl"})),U})()},get children(){return[S(x,{get when(){return r()===O.error},get children(){return d(fe)}}),S(x,{get when(){return r()===O.success},get children(){return S(Te,{get translate(){return e.translate},get itemMap(){return A()},get fusionSpriteMap(){return m()},get monsterA(){return s()},get monsterB(){return o()}})}})]}}),z,V),i})()]};export{he as FusionPanel};
