import{g as v,c as B,s as F,t as y,a as p,b as D,i as S,d as M,e as T,S as j,o as k,f as E,M as I,h as H}from"./web.DX5Voh54.js";const C={logoSplash:"/assets/img/evo_splash_04.png",loader:"/assets/img/loader.svg",moreStatusEffects:"/assets/img/passive_quest_icon.png",moves:"/assets/img/moves.png",characters:"/assets/img/characters.png",meta:"/assets/img/meta/meta_tape_default.png",metaTapeBg:"/assets/img/meta/meta_tape_bg.png",metaTapeBootlegBg:"/assets/img/meta/meta_tape_bootleg_bg.png",metaTapeOverlay:"/assets/img/meta/meta_tape_overlay.png",metaAp:"/assets/img/meta/ap.png",metaApx:"/assets/img/meta/ap-x.png",characterBg:"/assets/img/meta/character_bg.png",tapeBg:"/assets/img/meta/tape.png",tapeBootlegBg:"/assets/img/meta/tape_bootleg.png",tapeOverlay:"/assets/img/meta/tape_overlay.png",unknown:"/assets/img/passive_quest_icon.png"};var L=y("<img class=noselect draggable=false alt=loading>");const N=e=>{let r=3;switch(e.size){case"xs":r=1;break;case"sm":r=2;break;case"md":r=3;break;case"lg":r=6;break;case"xl":r=12;break}const g=`${r*8}px`;return(()=>{var l=v(L);return g!=null?l.style.setProperty("width",g):l.style.removeProperty("width"),g!=null?l.style.setProperty("height",g):l.style.removeProperty("height"),B(()=>F(l,"src",C.loader)),l})()};var R=y('<h2 class="ta-center mt-1">');const q=e=>{const[r,g]=p("");return D(()=>{if(e.monsterA==null&&e.monsterB==null){g("...");return}if(e.monsterA?.id==e.monsterB?.id){const l=(e.monsterA?.bestiary_index??0)%10,x=e.translate[`SAME_FUSION_NAME_${l+1}`];g(x.replace("{0}",e.monsterA?.name??""));return}g(`${e.monsterA?.prefix??"..."}${e.monsterB?.suffix??"..."}`)},[e.monsterA?.id,e.monsterB?.id]),(()=>{var l=v(R);return S(l,r),l})()},W=e=>Math.max(e.lastIndexOf("\\"),e.lastIndexOf("/")),U=e=>{const r=W(e);return e.substring(r+1)},G=e=>{if((e??"").indexOf("res://")<0)return e;const r=(e??"").replace("res://","");return r.length<1?"/assets/img/passive_quest_icon.png?old="+e:`/assets/img/generated/${r}`};var J=y("<img class=fusion-node>");const K=e=>{const r=e.sizeMultiplier??3,g=e.fusion??{};if(g.visible==!1)return;const l=(t,s)=>{let a=t[s.name];if(a==null){const o=U(s.instance_external_path??"").replace(".json","");a=t[o]}const i=a?.animations?.[0]?.frames?.[0];return{width:i?.width!=null?i.width*r+"px":"unset",height:i?.height!=null?i.height*r+"px":"unset"}},x=t=>t*r+"px",_=t=>{const s=t.instance_external_path??"",a=G(s.replace(".json",".png"));if((a?.length??0)!=0)return a},d=((t,s)=>{if(t==null)return;const a={...t};if((a?.parent?.length??0)!=0){const i=s[a.parent];if(i!=null){if(i.visible==!1)return;a.position.y=i.position.y,a.position.x=i.position.x}}return a})(g,e.fusionPartsList);if(d==null)return;const A=_(d);if(A!=null)return(()=>{var t=v(J);return F(t,"src",A),B(s=>{var a=d.name,i=d.name,o=x(d.position.y),n=x(d.position.x),u=l(e.fusionSpriteMap,d).width,m=l(e.fusionSpriteMap,d).height,c=d.index??0;return a!==s.e&&F(t,"id",s.e=a),i!==s.t&&F(t,"alt",s.t=i),o!==s.a&&((s.a=o)!=null?t.style.setProperty("top",o):t.style.removeProperty("top")),n!==s.o&&((s.o=n)!=null?t.style.setProperty("left",n):t.style.removeProperty("left")),u!==s.i&&((s.i=u)!=null?t.style.setProperty("width",u):t.style.removeProperty("width")),m!==s.n&&((s.n=m)!=null?t.style.setProperty("height",m):t.style.removeProperty("height")),c!==s.s&&((s.s=c)!=null?t.style.setProperty("z-index",c):t.style.removeProperty("z-index")),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),t})()};var Q=y("<div class=fusion-item>"),V=y('<div class="fusion-container mb-1">');const X=e=>{const[r,g]=p(),[l,x]=p(),[_,$]=p(0),[d,A]=p(0),[t,s]=p(1);D(()=>{if(e.fusionSpriteMap==null||e.itemMap==null)return;const i=e.itemMap[e.monsterA?.id??""];i!=null&&g(i.nodes_enhanced);const o=e.itemMap[e.monsterB?.id??""];o!=null&&x(o.nodes_enhanced);let n=0,u=0;for(const f of Object.values(e.fusionSpriteMap??{})){const h=f.animations[0].frames[0];h.height>n&&(n=h.height),h.width>u&&(u=h.width)}let m=0;for(const f of Object.values(i?.nodes_enhanced??{}))f.position.y<m&&(m=f.position.y);const c=screen.availHeight/2.5/n,P=screen.availWidth/2.5/u,b=Math.min(c,P);$(n),s(b),A(Math.abs(m)*b)},[e.monsterA?.id,e.monsterB?.id,e.fusionSpriteMap,e.itemMap]);const a=(i,o)=>{let n=[];for(const u of Object.values(i??{}))n.push(u);return n};return[M(q,{get translate(){return e.translate},get monsterA(){return e.monsterA},get monsterB(){return e.monsterB}}),(()=>{var i=v(V);return S(i,M(j,{get when(){return T(()=>r()!=null)()&&l()!=null},get children(){var o=v(Q);return S(o,()=>a(r(),l()).map(n=>M(K,{fusion:n,get fusionSpriteMap(){return e.fusionSpriteMap},get fusionPartsList(){return r()??{}},get sizeMultiplier(){return t()}}))),B(n=>{var u=`${d()}px`,m=t()*_()+"px",c=t()*_()+"px";return u!==n.e&&((n.e=u)!=null?o.style.setProperty("margin-top",u):o.style.removeProperty("margin-top")),m!==n.t&&((n.t=m)!=null?o.style.setProperty("height",m):o.style.removeProperty("height")),c!==n.a&&((n.a=c)!=null?o.style.setProperty("width",c):o.style.removeProperty("width")),n},{e:void 0,t:void 0,a:void 0}),o}})),i})()]},z="en";var w=(e=>(e[e.pending=0]="pending",e[e.loading=1]="loading",e[e.success=2]="success",e[e.error=3]="error",e))(w||{}),Y=y('<article class="mb-1 warning"><div class="card ta-center">⚠️ This is a work in progress'),Z=y("<summary data-todo=translate>❌ Something went wrong"),ee=y("<article class=mb-1><div class=fusion><div class=grid></div><!$><!/>"),te=y("<div class=fusion-container><div>");const ne=e=>{const[r,g]=p(),[l,x]=p(),[_,$]=p({}),[d,A]=p({}),[t,s]=p([]),[a,i]=p(w.loading),o=async()=>{const n=fetch(`/${z}/data/fusion.json`),u=fetch(`/${z}/data/fusionSpriteAnim.json`),m=fetch(`/${e.locale}/data/monsterDropDown.json`);try{const[c,P,b]=await Promise.all([n,u,m]),[f,h,O]=await Promise.all([c.json(),P.json(),b.json()]);$(f),A(h),s(O)}catch(c){console.log(c),i(w.error)}i(w.success)};return k(()=>{o()}),[v(Y),(()=>{var n=v(ee),u=n.firstChild,m=u.firstChild,c=m.nextSibling,[P,b]=E(c.nextSibling);return S(u,M(H,{get fallback(){return(()=>{var f=v(te),h=f.firstChild;return h.style.setProperty("margin","5vh auto"),S(h,M(N,{size:"xl"})),f})()},get children(){return[M(I,{get when(){return a()===w.error},get children(){return v(Z)}}),M(I,{get when(){return a()===w.success},get children(){return M(X,{get translate(){return e.translate},get itemMap(){return _()},get fusionSpriteMap(){return d()},get monsterA(){return r()},get monsterB(){return l()}})}})]}}),P,b),n})()]};export{ne as FusionPanel};
